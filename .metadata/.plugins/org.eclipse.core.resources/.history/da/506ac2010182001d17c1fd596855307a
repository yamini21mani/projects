package com.te.ecommerce.serviceimplementation;

import java.util.List;

import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.te.ecommerce.dto.AddressDto;
import com.te.ecommerce.dto.CustomerDto;
import com.te.ecommerce.dto.ProductDto;
import com.te.ecommerce.entity.BillingAddress;
import com.te.ecommerce.entity.Cart;
import com.te.ecommerce.entity.Customer;
import com.te.ecommerce.entity.Product;
import com.te.ecommerce.entity.SalesOrder;
import com.te.ecommerce.entity.ShippingAddress;
import com.te.ecommerce.exceptionhandling.CredentialsException;
import com.te.ecommerce.exceptionhandling.GeneralException;
import com.te.ecommerce.exceptionhandling.ProductException;
import com.te.ecommerce.otpgenerator.OtpGenerator;
import com.te.ecommerce.repository.BillingAddressRepository;
import com.te.ecommerce.repository.CustomerRepository;
import com.te.ecommerce.repository.ProductRepository;
import com.te.ecommerce.repository.ShippingAddressRepository;
import com.te.ecommerce.serviceinterface.CustomerService;

@Service
public class CustomerServiceImp implements CustomerService {
	@Autowired
	private CustomerRepository customerRepository;
	@Autowired
	private ProductRepository productRepository;
	@Autowired
	private ShippingAddressRepository shippingAddressRepository;
	@Autowired
	private BillingAddressRepository billingAddressRepository;
	@Autowired
	private OtpGenerator otpGenerator;
	@Autowired
	private Customer customer;
	@Autowired
	private ShippingAddress shippingAddress;
	@Autowired
	private SalesOrder salesOrder;
	@Autowired
	private BillingAddress billingAddress;
	@Autowired
	private Cart cart;

	public boolean register(Customer customer) {
		customer.setOtp(otpGenerator.generateRandomString(6));
		CustomerDto dto = new CustomerDto();
		if (dto.getOtp().equals(customer.getOtp())) {

			Customer registerdetails = customerRepository.save(customer);
			if (registerdetails != null)
				return true;
		} else
			throw new CredentialsException("Something went wrong");
		return false;
	}

	@Override
	public Product searchProductbyId(ProductDto productDto) {
		List<Product> allproducts = productRepository.findAll();
		for (Product product : allproducts) {
			if (productDto.getId() == product.getId())
				return product;
			else
				throw new ProductException("No relevant matches, Please check product ID");
		}
		return null;
	}

	@Override
	public Product searchProductbyCategory(ProductDto productDto) {
		List<Product> allproducts = productRepository.findAll();
		for (Product product : allproducts) {
			if (productDto.getCategory() == product.getCategory())
				return product;
			else
				throw new ProductException("No relevant matches, Please check product ID");
		}
		return null;

	}

	@Override
	public Product searchProductbyName(ProductDto productDto) {
		List<Product> allproducts = productRepository.findAll();
		for (Product product : allproducts) {
			if (productDto.getName() == product.getName())
				return product;
			else
				throw new ProductException("No relevant matches, Please check product ID");
		}
		return null;
	}

	@Override
	public List<Product> productList(ProductDto productDto) {
		List<Product> findAll = productRepository.findAll();
		return findAll;
	}

	@Override
	public Customer updateCustomer(CustomerDto customerDto) {
		BeanUtils.copyProperties(customerDto, customer);
		Customer founddata = customerRepository.findById(customer.getId())
				.orElseThrow(() -> new CredentialsException("no data found, please check the customerID"));
		if (founddata != null) {
			customer.setFirstName(customerDto.getFirstName());
			customer.setLastName(customerDto.getLastName());
			customer.setPassword(customerDto.getPassword());
			customer.setPhoneno(customerDto.getPhoneno());
			customer.setEmail(customerDto.getEmail());
			customer.setBillingAddress(billingAddress);
			customer.setCart(cart);
			customer.setSalesOrder(salesOrder);
			customer.setShippingAddress(shippingAddress);
			customerRepository.save(customer);
		}
		return customer;

	}

	@Override
	public void deleteCustomer(CustomerDto customerDto) {
		BeanUtils.copyProperties(customerDto, customer);
		Customer founddata = customerRepository.findById(customer.getId())
				.orElseThrow(() -> new CredentialsException("No data found, please enter right Customer ID"));
		customerRepository.delete(founddata);
	}

	@Override
	public Customer getCustomer(CustomerDto customerDto) {
		BeanUtils.copyProperties(customerDto, customer);
		Customer getCustomer = customerRepository.findById(customer.getId())
				.orElseThrow(() -> new CredentialsException("No data found,"));
		return getCustomer;
	}

	@Override
	public boolean addShippingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, shippingAddress);
		ShippingAddress save = shippingAddressRepository.save(shippingAddress);
		if (save != null)
			return true;
		else
			throw new GeneralException("unable to add Address Please check");
	}

	@Override
	public ShippingAddress getShippingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, shippingAddress);
		ShippingAddress getAddress = shippingAddressRepository.findById(shippingAddress.getId())
				.orElseThrow(() -> new GeneralException("No data found please check the id"));
		return getAddress;
	}

	@Override
	public ShippingAddress updateShippingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, shippingAddress);
		ShippingAddress founddata = shippingAddressRepository.findById(shippingAddress.getId())
				.orElseThrow(() -> new GeneralException("No data found please check the ID"));
		founddata.setAddress(addressDto.getAddress());
		founddata.setCity(addressDto.getCity());
		founddata.setCountry(addressDto.getCountry());
		founddata.setCustomer(customer);
		founddata.setSalesOrder(salesOrder);
		founddata.setState(addressDto.getState());
		founddata.setZipcode(addressDto.getZipcode());
		ShippingAddress save = shippingAddressRepository.save(founddata);
		return save;
	}

	@Override
	public void deleteShippingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, shippingAddress);
		ShippingAddress founddata = shippingAddressRepository.findById(shippingAddress.getId()).orElseThrow(()-> new GeneralException("No data found please check the ID"));
		shippingAddressRepository.delete(founddata);
	}

	@Override
	public boolean addBillingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, billingAddress);
		ShippingAddress save = shippingAddressRepository.save(shippingAddress);
		if (save != null)
			return true;
		else
			throw new GeneralException("unable to add Address Please check");
	}

	@Override
	public BillingAddress getBillingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, shippingAddress);
		ShippingAddress getAddress = shippingAddressRepository.findById(shippingAddress.getId())
				.orElseThrow(() -> new GeneralException("No data found please check the id"));
		return getAddress;
		return null;
	}

	@Override
	public BillingAddress updateBillingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, billingAddress);
		BillingAddress founddata = billingAddressRepository.findById(billingAddress.getId())
				.orElseThrow(() -> new GeneralException("No data found please check the ID"));
		founddata.setAddress(addressDto.getAddress());
		founddata.setCity(addressDto.getCity());
		founddata.setCountry(addressDto.getCountry());
		founddata.setCustomer(customer);
		founddata.setSalesOrder(salesOrder);
		founddata.setState(addressDto.getState());
		founddata.setZipcode(addressDto.getZipcode());
		BillingAddress save = billingAddressRepository.save(founddata);
		return save;

	}

	public void deleteBillingAddress(AddressDto addressDto) {
		BeanUtils.copyProperties(addressDto, shippingAddress);
		BillingAddress founddata = billingAddressRepository.findById(shippingAddress.getId()).orElseThrow(()-> new GeneralException("No data found please check the ID"));
		billingAddressRepository.delete(founddata);
	}

}
